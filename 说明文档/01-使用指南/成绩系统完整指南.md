# 成绩系统完整指南

本文档整合了成绩管理系统的所有使用说明和技术文档，包含系统概述、管理模块使用、录入系统使用和数据库查询功能说明。

---

## 第一部分：成绩管理系统概述

EduCloud 成绩管理系统包含两个主要模块：

1. **成绩管理模块** (`/ui/grades`) - 用于查看、统计和管理已录入的成绩
2. **成绩录入系统** (`/ui/grades-entry`) - 用于快速录入学生成绩（支持平时分+期末分）

### 模块对比

| 功能 | 成绩管理模块 | 成绩录入系统 |
|------|------------|------------|
| **主要用途** | 查看和统计成绩 | 录入和编辑成绩 |
| **访问路径** | `/ui/grades` | `/ui/grades-entry` |
| **筛选功能** | 多维度筛选（学院/专业/班级/课程） | 按学院-专业筛选课程 |
| **成绩录入** | 单个录入（模态框） | 批量录入（表格） |
| **平时分/期末分** | 不支持 | 支持 |
| **实时计算** | 不支持 | 支持 |
| **成绩占比** | 不支持 | 支持自定义 |
| **统计分析** | 支持（按学院/专业/班级） | 不支持 |
| **批量导入** | 支持 | 不支持 |
| **数据导出** | 支持 | 不支持 |

### 使用场景

#### 场景1：学期开始，录入平时成绩
**推荐使用**：成绩录入系统

1. 访问 `/ui/grades-entry`
2. 选择课程和班级
3. 设置成绩占比（例如：平时分60%，期末分40%）
4. 录入平时分
5. 保存（期末分可以稍后再录）

#### 场景2：期末考试后，录入期末成绩
**推荐使用**：成绩录入系统

1. 访问 `/ui/grades-entry`
2. 选择课程和班级
3. 系统自动加载已有的平时分
4. 录入期末分，总评自动计算
5. 保存

#### 场景3：查看班级成绩情况
**推荐使用**：成绩管理模块

1. 访问 `/ui/grades`
2. 筛选班级
3. 查看成绩列表
4. 查看及格率、平均分等

#### 场景4：统计分析（按学院/专业/班级）
**推荐使用**：成绩管理模块

1. 访问 `/ui/grades`
2. 点击"查看统计"
3. 选择统计维度（学院/专业/班级）
4. 查看平均分、及格率等统计数据
5. 可导出统计数据

#### 场景5：批量导入成绩（CSV/Excel）
**推荐使用**：成绩管理模块

1. 访问 `/ui/grades`
2. 点击"批量导入"
3. 按格式准备数据
4. 粘贴或上传
5. 导入

---

## 第二部分：成绩管理模块使用指南

### 功能概述

成绩管理系统已经完成开发，支持不同角色用户的成绩管理需求。

### 角色权限说明

#### 1. 学生（student）
- **查看权限**：只能查看自己的成绩
- **功能**：
  - 查看所有科目成绩
  - 按课程筛选查看成绩
  - 查看成绩状态（及格/不及格）
  - 查看 GPA

#### 2. 班主任（head_teacher）
- **查看权限**：可以查看自己管理班级的所有学生成绩
- **功能**：
  - 查看班级学生的所有成绩
  - 按课程筛选查看
  - 按学生筛选查看
  - 按及格状态筛选
  - 录入和修改本班学生成绩
  - 批量导入成绩
  - 导出成绩数据
  - 弹窗查看班级成绩详情

#### 3. 教师（teacher）
- **查看权限**：可以查看自己所教课程的所有学生成绩
- **管理权限**：可以管理自己所教课程的学生成绩
- **功能**：
  - 按班级筛选查看学生成绩
  - 按课程筛选（自己教授的课程）
  - 录入学生成绩
  - 修改学生成绩
  - 批量导入成绩
  - 导出成绩数据
  - 审核成绩

#### 4. 管理人员（校长、副校长、院长、副院长、超级管理员）
- **查看权限**：
  - 校长、副校长、超级管理员：可以查看所有成绩
  - 院长、副院长：可以查看本学院的所有成绩
- **管理权限**：完整的成绩管理权限
- **功能**：
  - 多维度筛选：按学院、专业、班级、课程、学生搜索、及格状态、审核状态
  - 成绩统计分析：按学院/专业/班级统计（平均分、及格率、优秀率）
  - 数据管理：录入、修改、删除成绩、批量导入、导出成绩、导出统计数据

### 使用说明

#### 访问成绩管理页面
1. 登录系统后，在导航菜单中选择"成绩管理"
2. 或直接访问：`/ui/grades`

#### 筛选功能
- **学院筛选**：选择学院后，专业和班级列表会自动更新
- **专业筛选**：选择专业后，班级列表会自动更新
- **班级筛选**：精确到具体班级
- **课程筛选**：按课程查看成绩
- **学生搜索**：输入学生姓名或学号进行模糊搜索
- **及格状态**：筛选及格/不及格的成绩
- **审核状态**：筛选已审核/未审核的成绩

#### 录入成绩
1. 点击"录入成绩"按钮
2. 选择学生
3. 选择课程
4. 输入成绩（0-100）
5. 可选：输入 GPA（0-5）
6. 可选：勾选"已审核"
7. 点击"保存"

#### 批量导入成绩
1. 点击"批量导入"按钮
2. 按照格式要求准备数据：
   - 格式：学生ID,课程ID,成绩,GPA(可选)
   - 示例：1,5,85.5,4.0
3. 粘贴数据到文本框
4. 点击"导入"

#### 查看统计数据（管理员）
1. 点击"查看统计"按钮
2. 选择统计维度：按学院统计、按专业统计、按班级统计
3. 可选：选择学院或专业进行筛选
4. 查看统计结果：学生总数、成绩记录数、平均分、及格率、优秀率等
5. 可导出统计数据

---

## 第三部分：成绩录入系统使用指南

### 功能概述

成绩录入系统提供了一个直观的三步流程，帮助教师快速录入学生成绩。系统支持平时分和期末分的分别录入，并实时计算总评成绩。

### 访问入口

- **URL**: `/ui/grades-entry`
- **导航**: 在成绩管理页面中可以找到"成绩录入系统"的入口

### 使用流程

#### 第一步：选择课程

**筛选功能**：
1. **学院筛选** - 选择学院后，专业列表会自动更新，课程列表会显示该学院下的所有课程
2. **专业筛选** - 选择专业后，课程列表会显示该专业的课程
3. **课程搜索** - 输入课程名称或课程代码进行模糊搜索，实时过滤显示匹配的课程

**课程列表显示**：
- 课程代码
- 课程名称
- 课程类型（必修/选修/实践）
- 所属专业
- 授课教师

点击"选择"按钮进入下一步。

#### 第二步：选择班级

系统会显示该课程的所有授课班级，每个班级卡片包含：
- 班级名称
- 所属学院
- 所属专业
- 年级（入学年份）

点击任意班级卡片进入成绩录入页面。

#### 第三步：成绩录入

**成绩占比设置**（重要功能）：
- **平时分占比 (%)**：默认值50%，范围0-100，可以根据课程要求调整
- **期末分占比 (%)**：默认值50%，范围0-100
- **验证规则**：平时分占比 + 期末分占比 = 100%
- 如果不等于100%，系统会显示警告提示
- 只有占比正确才能保存成绩

**常用配置示例**：
- 平时分50% + 期末分50%（均衡型）
- 平时分40% + 期末分60%（重视期末）
- 平时分60% + 期末分40%（重视平时）
- 平时分30% + 期末分70%（传统型）

**成绩录入表格**：
1. **序号**：学生在班级中的序号
2. **学号**：学生的学号
3. **姓名**：学生姓名
4. **平时分**：输入框，范围0-100
5. **期末分**：输入框，范围0-100
6. **总评**：自动计算，只读显示

**实时计算功能**：
当输入平时分或期末分时，总评会实时计算并显示。

计算公式：
```
总评 = 平时分 × 平时分占比% + 期末分 × 期末分占比%
```

**成绩颜色标识**：
- **绿色**：≥90分（优秀）
- **蓝色**：60-89分（及格）
- **红色**：<60分（不及格）

**辅助功能**：
1. **清空所有** - 清空所有输入框中的成绩，需要确认操作
2. **填充示例数据** - 自动为所有学生填充随机成绩（60-100分），用于测试和演示
3. **保存全部成绩** - 批量保存所有已录入的成绩，只保存至少有一个成绩的学生

### 使用技巧

1. **快速录入**：使用 Tab 键在输入框之间快速切换，按 Enter 键自动跳到下一个输入框
2. **占比调整**：修改占比后，所有学生的总评会自动重新计算，建议在录入成绩前先设置好占比
3. **分批录入**：可以先录入平时分保存，稍后再录入期末分再次保存，系统会自动更新总评
4. **成绩校验**：输入范围0-100，支持小数（最多1位）

### 最佳实践

**成绩录入流程建议**：
- **步骤1：课程规划** - 在学期开始前确定每门课程的成绩占比
- **步骤2：分阶段录入** - 平时分在学期中定期录入，期末分考试结束后集中录入
- **步骤3：成绩审核** - 录入完成后检查总评分数，注意不及格学生

**占比设置建议**：
| 课程类型 | 平时分 | 期末分 | 说明 |
|---------|-------|-------|------|
| 理论课程 | 30% | 70% | 重视期末考试 |
| 实践课程 | 60% | 40% | 重视平时表现 |
| 项目课程 | 70% | 30% | 重视过程评价 |
| 通识课程 | 50% | 50% | 平衡考核 |

---

## 第四部分：数据库查询功能说明

### 数据来源确认

所有数据都从数据库实时获取，没有硬编码或假数据。

### 组织层级筛选功能

#### 学院筛选（College）
- **API 端点**：`GET /api/org/colleges/`
- **支持的筛选**：按状态筛选（启用/停用）、按学院代码或名称搜索

#### 专业筛选（Major）
- **API 端点**：`GET /api/org/majors/`
- **支持的筛选**：按学院ID筛选、按学制类型筛选、按专业代码或名称搜索

#### 班级筛选（Class）
- **API 端点**：`GET /api/org/classes/`
- **支持的筛选**：按专业ID筛选、按入学年份筛选、按班级名称搜索

### 课程搜索功能

- **API 端点**：`GET /api/courses/courses/`
- **支持的筛选**：按专业ID筛选、按学院ID筛选、搜索课程名称、教师姓名、专业名称

### 权限控制

所有数据查询都经过权限验证：
- **学院/专业/班级**：所有已认证用户可以查看（用于下拉框选择），管理员可以增删改
- **课程**：所有已认证用户可以查看，教师和管理员可以创建和修改
- **成绩**：根据用户角色自动过滤（学生只能看自己的，教师只能看所教课程的，班主任只能看本班的，管理员可以看所有）

### 性能优化

1. **Select Related 优化**：预加载关联数据，减少数据库查询次数
2. **不分页返回**：用于下拉框的数据不分页，提高加载速度
3. **前端数据处理**：智能处理分页和非分页数据

---

## 数据模型

### Grade（成绩模型）

```python
class Grade(models.Model):
    # 关联
    student = ForeignKey(StudentProfile)     # 学生
    course = ForeignKey(Course)              # 课程
    
    # 成绩
    score = DecimalField()                   # 总评成绩
    regular_score = DecimalField()           # 平时分
    final_score = DecimalField()             # 期末分
    
    # 占比
    regular_weight = DecimalField()          # 平时分占比(%)
    final_weight = DecimalField()            # 期末分占比(%)
    
    # 其他
    gpa = DecimalField()                     # GPA
    approved = BooleanField()                # 是否审核
    created_at = DateTimeField()             # 创建时间
    updated_at = DateTimeField()             # 更新时间
```

### 自动计算逻辑

```python
def calculate_total_score(self):
    if self.regular_score and self.final_score:
        total = (self.regular_score * self.regular_weight / 100 + 
                self.final_score * self.final_weight / 100)
        return round(total, 2)
    return None

def save(self, *args, **kwargs):
    # 保存时自动计算总评
    calculated_score = self.calculate_total_score()
    if calculated_score:
        self.score = calculated_score
    super().save(*args, **kwargs)
```

---

## API 端点汇总

### 成绩管理 API

| 方法 | 端点 | 说明 |
|------|------|------|
| GET | `/api/grades/grades/` | 获取成绩列表 |
| POST | `/api/grades/grades/` | 创建成绩 |
| GET | `/api/grades/grades/{id}/` | 获取单条成绩 |
| PUT | `/api/grades/grades/{id}/` | 更新成绩 |
| DELETE | `/api/grades/grades/{id}/` | 删除成绩 |
| GET | `/api/grades/grades/my_grades/` | 学生查看自己成绩 |
| GET | `/api/grades/grades/class_grades/` | 班主任查看班级成绩 |
| GET | `/api/grades/grades/teacher_grades/` | 教师查看课程成绩 |
| GET | `/api/grades/grades/statistics/` | 成绩统计分析 |
| POST | `/api/grades/grades/batch_create/` | 批量创建成绩 |
| GET | `/api/grades/grades/export/` | 导出成绩 |

### 成绩录入 API

| 方法 | 端点 | 说明 |
|------|------|------|
| GET | `/api/grades/grades/course_classes/` | 获取课程的授课班级 |
| GET | `/api/grades/grades/class_students_grades/` | 获取班级学生成绩 |
| POST | `/api/grades/grades/batch_save_grades/` | 批量保存成绩 |

---

## 常见问题

### Q1: 总评计算不正确？
**A**: 确保平时分占比 + 期末分占比 = 100%

### Q2: 看不到课程？
**A**: 确认用户角色、确认教师有授课记录、确认课程已关联到专业

### Q3: 为什么我看不到某些学生的成绩？
**A**: 系统根据您的角色自动过滤数据。教师只能看到自己所教课程的学生成绩，班主任只能看到自己班级的学生成绩。

### Q4: 可以只录入平时分或期末分吗？
**A**: 可以，但总评需要两个成绩都有才能计算。

### Q5: 下拉框是空的怎么办？
**A**: 需要先在系统中添加基础数据：学院、专业、班级、课程、教师、学生。

---

## 注意事项

1. **权限控制**：系统会根据用户角色自动过滤可见数据，确保数据安全
2. **数据验证**：成绩必须在0-100之间，GPA必须在0-5之间，学生和课程的组合必须唯一
3. **审核流程**：建议成绩录入后进行审核，审核后的成绩应谨慎修改
4. **批量操作**：批量导入时请确保数据格式正确，错误的记录会被跳过
5. **统计数据**：统计数据实时计算，反映最新的成绩情况

---

**版本**：1.0.0  
**更新日期**：2024年  
**维护者**：EduCloud 开发团队
