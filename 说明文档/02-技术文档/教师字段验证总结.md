# 教师管理字段验证规则实现总结

## 概述
本次修改实现了教师管理系统中不同角色的差异化字段验证规则，确保各角色的必填和可选字段符合业务需求。

## 验证规则

### 1. 教师（teacher）
- **必填字段**：工号、姓名
- **可选字段**：学院、专业、联系电话

### 2. 班主任（head_teacher）
- **必填字段**：工号、姓名、学院-专业、联系电话、管理班级
- **说明**：班主任必须完整填写所有相关信息以便管理班级（选择专业时会自动关联学院）

### 3. 院长/副院长（dean/vice_dean）
- **必填字段**：工号、姓名、学院
- **可选字段**：专业、联系电话
- **说明**：院长/副院长至少需要关联到学院，专业可选

### 4. 校长（principal）
- **必填字段**：工号、姓名
- **可选字段**：学院、专业、联系电话
- **说明**：校长职位最灵活，仅需基本信息

## 修改文件清单

### 1. 后端 - Serializer（`accounts/serializers.py`）
**修改内容**：
- 更新 `TeacherProfileSerializer` 字段定义
  - `phone` 字段改为可选：`required=False, allow_blank=True, allow_null=True`
  - 新增 `college_id` 字段用于院长/副院长只选学院的情况
- 新增 `validate()` 方法实现角色相关的验证逻辑
  - 验证工号和姓名在所有角色都必填
  - 班主任验证：学院-专业、联系电话、班级必填（专业包含学院信息）
  - 院长/副院长验证：学院必填
  - 其他角色无额外验证
- 更新 `create()` 方法
  - 处理 `college_id` 参数
  - 支持只提供学院而不提供专业的情况
- 更新 `update()` 方法
  - 处理 `college_id` 参数
  - 支持编辑时的学院选择

### 2. 前端 - JavaScript（`static/js/teachers/teachers.js`）
**修改内容**：
- 更新 `addTeacher()` 函数
  - 移除了统一的必填验证
  - 根据不同角色实施差异化验证
  - 班主任：验证专业、电话、班级必填
  - 院长/副院长：验证学院必填
  - 电话格式验证仅在填写时执行
  - 支持只提供学院或专业的组合
- 更新 `toggleAddClass()` 函数
  - 动态更新字段占位符显示必填标识（*）
  - 根据角色显示/隐藏班级选择器
- 更新 `saveEdit()` 函数
  - 实施与添加相同的差异化验证规则
  - 支持 `college_id` 参数传递
- 更新 `toggleEditClass()` 函数
  - 动态更新标签显示必填标识

### 3. 前端 - HTML模板（`templates/teachers.html`）
**修改内容**：
- 更新表单输入框占位符，标记必填字段（*）
- 添加字段验证规则提示信息
  - 在表单下方显示各角色的必填字段说明
  - 使用列表形式清晰展示规则

## 测试结果

创建了 `test_teacher_validation.py` 测试脚本，所有测试用例均通过：

### 测试用例
1. ✅ 普通教师 - 只填写工号和姓名（通过）
2. ✅ 普通教师 - 缺少姓名（正确拒绝）
3. ✅ 班主任 - 缺少联系电话（正确拒绝）
4. ✅ 班主任 - 缺少专业（正确拒绝）
5. ✅ 院长 - 只提供学院（通过）
6. ✅ 院长 - 缺少学院和专业（正确拒绝）
7. ✅ 校长 - 只填写工号和姓名（通过）

## 用户体验改进

1. **动态提示**：根据选择的职务类型，表单自动更新必填字段提示
2. **清晰的错误信息**：验证失败时显示明确的错误提示
3. **灵活的数据输入**：
   - 普通教师和校长可以不填写任何组织信息
   - 院长可以只选学院而不选专业
   - 班主任必须完整填写以确保班级管理的准确性

## 兼容性说明

- 后端验证与前端验证规则完全一致
- 支持通过 API 直接调用和通过 UI 操作两种方式
- 已有数据不受影响，仅影响新增和编辑操作

## 使用方法

### 添加教师
1. 选择职务类型
2. 系统自动显示该职务的必填字段要求
3. 填写相应信息并提交

### 编辑教师
1. 点击编辑按钮
2. 可以修改职务类型
3. 系统自动调整必填字段要求
4. 保存时执行对应的验证规则

## 技术特点

1. **前后端双重验证**：确保数据完整性和安全性
2. **动态UI更新**：用户体验友好
3. **角色驱动验证**：灵活应对不同角色的业务需求
4. **完整的错误处理**：提供清晰的错误提示

## 注意事项

1. 工号必须是字母和数字的组合，不能包含特殊字符
2. 联系电话格式验证：必须是11位以1开头的手机号
3. 班主任必须分配管理班级，否则无法保存
4. 院长/副院长可以不选专业，但必须选择学院

## 后续建议

1. 可以考虑添加性别字段的选择（目前默认为男）
2. 可以添加更多的职位类型支持
3. 可以增强电话号码验证，支持座机号码格式
4. 可以添加邮箱字段验证

## 维护说明

如需修改验证规则，需要同时修改：
1. `accounts/serializers.py` - `TeacherProfileSerializer.validate()` 方法
2. `static/js/teachers/teachers.js` - `addTeacher()` 和 `saveEdit()` 函数
3. `templates/teachers.html` - 表单提示信息

确保前后端规则保持一致。

