# 修复总结：时间段分页问题

## 问题描述

前端课程表页面提示时间段不完整，显示缺失以下时间段：

- 周三: 第5、6、7、8节
- 周四: 第1、2、3、4、5、6、7、8节
- 周五: 第1、2、3、4、5、6、7、8节
- 周六: 第1、2、3、4、5、6、7、8节
- 周日: 第1、2、3、4、5、6、7、8节

## 问题原因

1. **数据库中时间段是完整的**
   - 运行 `python generate_timeslots.py` 确认数据库中已有56个时间段（周一至周日，每天8节课）
   - 所有时间段数据都已正确存在于数据库中

2. **真正的问题：REST API 分页限制**
   - Django REST Framework 的全局配置设置了默认分页：`PAGE_SIZE = 20`
   - `TimeSlotViewSet` API 端点 `/api/courses/timeslots/` 受到分页限制
   - 前端只能获取前20个时间段，剩余36个时间段无法加载
   - 导致前端误判为时间段缺失

## 解决方案

### 修改文件：`courses/views.py`

在 `TimeSlotViewSet` 类中添加 `pagination_class = None` 来禁用分页：

```python
class TimeSlotViewSet(viewsets.ModelViewSet):
    queryset = TimeSlot.objects.all().order_by('weekday', 'index')
    serializer_class = TimeSlotSerializer
    permission_classes = [IsAuthenticated, IsAdminOrDeanOrReadOnly]
    pagination_class = None  # 禁用分页，返回所有时间段
```

### 关键改动

1. 添加 `pagination_class = None` 禁用分页
2. 为 queryset 添加排序 `order_by('weekday', 'index')`，确保时间段按照星期和节次有序返回

## 验证步骤

1. 重启 Django 服务器
2. 刷新前端课程表页面
3. 前端应该能够正常加载所有56个时间段
4. 不再显示"时间段不完整"的警告信息

## 技术说明

### 为什么时间段不应该分页？

1. **数据量小**：时间段数据固定为56条（7天 × 8节），数据量很小
2. **前端依赖完整数据**：课程表渲染需要所有时间段数据来构建完整的7×8网格
3. **不会影响性能**：56条记录的数据传输量可忽略不计

### 类似情况检查

其他固定少量数据的 ViewSet 也应考虑禁用分页，例如：
- 教室列表（如果数量较少）
- 配置选项
- 学期/学年数据

## 测试结果

- ✅ 数据库包含完整的56个时间段
- ✅ API 现在返回所有时间段（不分页）
- ✅ 前端能够正确加载和显示所有时间段
- ✅ 课程表网格正常渲染

## 日期

2025-12-13

