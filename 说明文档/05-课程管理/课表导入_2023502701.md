# 2023502701班课表导入说明

## 📋 班级信息
- **班级名称**: 23移动互联网应用技术G5-1班
- **班级ID**: 2023502701
- **学年学期**: 2025-2026学年第一学期

---

## 📚 课表内容

### 教师信息（6位）
| 工号 | 姓名 | 默认密码 |
|------|------|---------|
| T2024001 | 李雪莲 | 123456 |
| T2024002 | 刘欢 | 123456 |
| T2024003 | 王明超 | 123456 |
| T2024004 | 宋小莹 | 123456 |
| T2024005 | 李新宇 | 123456 |
| T2024006 | 梁语馨 | 123456 |

### 课程信息（6门）
| 课程名称 | 授课教师 | 类型 |
|---------|---------|------|
| ArkTS基础应用开发 | 李雪莲 | 必修 |
| 历史 | 刘欢 | 必修 |
| 移动web开发 | 王明超 | 必修 |
| 商务英语 | 宋小莹 | 必修 |
| 数据库技术与应用 | 李新宇 | 必修 |
| Python项目开发 | 梁语馨 | 必修 |

### 教室信息（6间）
| 教室编号 | 容量 |
|---------|------|
| 507 (5号楼) | 50人 |
| 215 (2号楼) | 60人 |
| 505 (5号楼) | 50人 |
| 404 (4号楼) | 50人 |
| 西山II1411 | 60人 |
| 西山II1101 | 60人 |

### 课表安排（11节课）

#### 📅 星期一
| 节次 | 课程 | 教师 | 教室 | 周次 |
|------|------|------|------|------|
| 第1节 | ArkTS基础应用开发 | 李雪莲 | 507 | 1-18周 |
| 第3节 | 商务英语 | 宋小莹 | 404 | 1-18周 |
| 第5节 | 数据库技术与应用 | 李新宇 | 西山II1411 | 1-18周 |

#### 📅 星期二
| 节次 | 课程 | 教师 | 教室 | 周次 |
|------|------|------|------|------|
| 第1节 | 历史 | 刘欢 | 215 | 1-18周 |
| 第3节 | 商务英语 | 宋小莹 | 404 | 1-18周 |
| 第5节 | Python项目开发 | 梁语馨 | 西山II1101 | 1-18周 |

#### 📅 星期三
| 节次 | 课程 | 教师 | 教室 | 周次 |
|------|------|------|------|------|
| 第2节 | 移动web开发 | 王明超 | 505 | 1-18周 |
| 第5节 | Python项目开发 | 梁语馨 | 西山II1101 | 1-18周 |

#### 📅 星期四
| 节次 | 课程 | 教师 | 教室 | 周次 |
|------|------|------|------|------|
| 第1节 | ArkTS基础应用开发 | 李雪莲 | 507 | 1-18周 |
| 第5节 | 数据库技术与应用 | 李新宇 | 西山II1411 | 1-18周 |

#### 📅 星期五
| 节次 | 课程 | 教师 | 教室 | 周次 |
|------|------|------|------|------|
| 第2节 | 移动web开发 | 王明超 | 505 | 1-18周 |

---

## 🚀 导入步骤

### 方法一: 使用批处理文件（推荐）

#### 1. 双击运行
```
import_schedule_2023502701.bat
```

#### 2. 查看执行结果
脚本会自动：
- ✅ 创建6位教师
- ✅ 创建6门课程
- ✅ 创建6间教室
- ✅ 创建11节排课记录

### 方法二: 使用命令行

#### 1. 打开命令提示符
在项目目录下，按住 `Shift` + 右键，选择"在此处打开命令窗口"

#### 2. 执行导入脚本
```bash
python import_class_2023502701_schedule.py
```

---

## ⚠️ 前置条件

### 必须完成：

#### 1. 班级必须存在
确保班级 `2023502701` 已经在系统中创建。

**检查方法**:
```bash
python manage.py shell
```
```python
from organization.models import Class
cls = Class.objects.filter(class_id='2023502701').first()
if cls:
    print(f"班级存在: {cls.name}")
else:
    print("班级不存在，需要先创建！")
```

**创建班级方法**:
访问系统管理界面创建班级，或运行：
```python
from organization.models import Class, Major
department = Major.objects.first()  # 选择合适的专业
Class.objects.create(
    class_id='2023502701',
    name='23移动互联网应用技术G5-1班',
    department=department,
    grade=2023,
    class_type='administrative'
)
```

#### 2. 时间段必须初始化
系统中必须有时间段配置。

**检查方法**:
```bash
python manage.py shell
```
```python
from courses.models import TimeSlot
print(f"时间段数量: {TimeSlot.objects.count()}")
```

**初始化时间段**:
如果时间段为0，访问系统并生成标准时间段，或运行：
```python
from courses.views import GenerateStandardTimeSlotsView
from django.test import RequestFactory

factory = RequestFactory()
request = factory.post('/api/courses/timeslots/generate')
view = GenerateStandardTimeSlotsView()
view.post(request)
```

---

## 📊 执行结果示例

```
======================================================================
开始导入 2023502701 班级课表
2025-2026学年第一学期 23移动互联网应用技术G5-1班
======================================================================

【步骤1】查找班级...
✓ 找到班级: 23移动互联网应用技术G5-1班 (ID: 2023502701)
  专业: 移动互联网应用技术

【步骤2】创建教师...
✓ 创建教师: 李雪莲 (工号: T2024001)
✓ 创建教师: 刘欢 (工号: T2024002)
✓ 创建教师: 王明超 (工号: T2024003)
✓ 创建教师: 宋小莹 (工号: T2024004)
✓ 创建教师: 李新宇 (工号: T2024005)
✓ 创建教师: 梁语馨 (工号: T2024006)

【步骤3】创建课程...
✓ 创建课程: ArkTS基础应用开发 (教师: 李雪莲)
✓ 创建课程: 历史 (教师: 刘欢)
✓ 创建课程: 移动web开发 (教师: 王明超)
✓ 创建课程: 商务英语 (教师: 宋小莹)
✓ 创建课程: 数据库技术与应用 (教师: 李新宇)
✓ 创建课程: Python项目开发 (教师: 梁语馨)

【步骤4】创建教室...
✓ 创建教室: 5号楼-507
✓ 创建教室: 2号楼-215
✓ 创建教室: 5号楼-505
✓ 创建教室: 4号楼-404
✓ 创建教室: 西山II-1411
✓ 创建教室: 西山II-1101

【步骤5】检查时间段...
✓ 时间段已就绪 (共 40 个)

【步骤6】创建排课...
  ✓ 排课成功: ArkTS基础应用开发 - 周1第1节 - 5号楼507
  ✓ 排课成功: 商务英语 - 周1第3节 - 4号楼404
  ✓ 排课成功: 数据库技术与应用 - 周1第5节 - 西山II1411
  ✓ 排课成功: 历史 - 周2第1节 - 2号楼215
  ✓ 排课成功: 商务英语 - 周2第3节 - 4号楼404
  ✓ 排课成功: Python项目开发 - 周2第5节 - 西山II1101
  ✓ 排课成功: 移动web开发 - 周3第2节 - 5号楼505
  ✓ 排课成功: Python项目开发 - 周3第5节 - 西山II1101
  ✓ 排课成功: ArkTS基础应用开发 - 周4第1节 - 5号楼507
  ✓ 排课成功: 数据库技术与应用 - 周4第5节 - 西山II1411
  ✓ 排课成功: 移动web开发 - 周5第2节 - 5号楼505

======================================================================
导入完成！成功创建 11 条排课记录
======================================================================

📊 统计信息:
  - 教师: 6 人
  - 课程: 6 门
  - 教室: 6 间
  - 排课: 11 节

🔗 访问链接:
  - 课程管理: http://localhost:8000/courses
  - 查看课表: http://localhost:8000/courses?class=2023502701

👤 默认密码: 123456
```

---

## 🔍 验证导入结果

### 方法一: Web界面验证

1. **登录系统**
   - 访问: `http://localhost:8000/login`
   - 使用管理员账号登录

2. **查看课程**
   - 访问: `http://localhost:8000/courses`
   - 搜索课程名称验证

3. **查看课表**
   - 在课程管理页面
   - 选择"按班级"视图
   - 选择"2023502701"班
   - 查看第1周课表

### 方法二: Django Shell验证

```bash
python manage.py shell
```

```python
from courses.models import Course, CourseSchedule
from accounts.models import TeacherProfile
from organization.models import Class

# 验证班级
cls = Class.objects.get(class_id='2023502701')
print(f"班级: {cls.name}")

# 验证教师
teachers = TeacherProfile.objects.filter(teacher_id__startswith='T2024')
print(f"教师数量: {teachers.count()}")
for t in teachers:
    print(f"  - {t.user_profile.user.first_name} ({t.teacher_id})")

# 验证课程
courses = Course.objects.filter(department=cls.department)
print(f"\n课程数量: {courses.count()}")
for c in courses:
    print(f"  - {c.name} (教师: {c.teacher.user_profile.user.first_name})")

# 验证排课
schedules = CourseSchedule.objects.filter(school_class=cls, week_number=1)
print(f"\n排课数量: {schedules.count()}")
for s in schedules:
    print(f"  - 周{s.timeslot.weekday}第{s.timeslot.index}节: {s.course.name}")
```

---

## 🔧 故障排除

### 问题1: 班级不存在
**错误信息**: `✗ 班级不存在，需要先创建班级！`

**解决方法**:
1. 在系统中手动创建班级
2. 或使用Django Shell创建：
```python
from organization.models import Class, Major
department = Major.objects.first()
Class.objects.create(
    class_id='2023502701',
    name='23移动互联网应用技术G5-1班',
    department=department,
    grade=2023
)
```

### 问题2: 时间段未初始化
**错误信息**: `✗ 时间段未初始化！`

**解决方法**:
访问课程管理页面，点击"生成标准时间段"按钮，或运行：
```bash
curl -X POST http://localhost:8000/api/courses/timeslots/generate
```

### 问题3: 教师工号冲突
**错误信息**: `IntegrityError: UNIQUE constraint failed`

**解决方法**:
编辑脚本 `import_class_2023502701_schedule.py`，修改教师工号：
```python
teachers = {
    'lixuelian': get_or_create_teacher('T2024101', '李雪莲', department),
    # ... 修改工号避免冲突
}
```

### 问题4: 排课冲突
**错误信息**: `ValidationError: 教师在该时间段已有课程安排`

**解决方法**:
1. 检查是否有其他班级占用了相同教师的时间段
2. 使用冲突检测功能查看具体冲突
3. 调整课表时间或更换教师

---

## 📝 扩展功能

### 为多个周次创建排课

默认脚本只创建第1周的排课，如需为第1-18周全部创建，修改脚本：

```python
# 修改 create_schedule 调用
for week in range(1, 19):  # 1-18周
    for item in schedule_data:
        timeslot = get_timeslot(item['day'], item['period'])
        if not timeslot:
            continue
        
        create_schedule(
            school_class=school_class,
            course=courses[item['course']],
            teacher=teachers[item['teacher']],
            classroom=classrooms[item['room']],
            timeslot=timeslot,
            week_number=week,  # 使用循环的周次
            created_by=admin_user
        )
```

### 批量导入多个班级

如果有多个班级需要导入，可以：
1. 复制脚本文件
2. 修改班级ID和课表数据
3. 分别运行

或者编写循环脚本批量处理。

---

## 📞 技术支持

如有问题，请查阅：
- [课程管理设计文档](./COURSE_MANAGEMENT_DESIGN.md)
- [快速参考指南](./QUICK_REFERENCE.md)
- [跨学院授课指南](./CROSS_COLLEGE_TEACHING.md)

---

**版本**: 1.0  
**创建日期**: 2025-12-09  
**适用班级**: 2023502701 (23移动互联网应用技术G5-1班)

