# è·¨å­¦é™¢/ä¸“ä¸šæˆè¯¾åŠŸèƒ½æŒ‡å—

## ğŸ“š åŠŸèƒ½æ¦‚è¿°

EduCloudç³»ç»Ÿ**å®Œå…¨æ”¯æŒ**è·¨å­¦é™¢ã€è·¨ä¸“ä¸šæˆè¯¾ï¼Œæ»¡è¶³ç°ä»£é«˜æ ¡çµæ´»çš„æ•™å­¦ç®¡ç†éœ€æ±‚ã€‚

### âœ¨ æ ¸å¿ƒç‰¹æ€§

âœ… **æ— é™åˆ¶æˆè¯¾**: ä»»ä½•æ•™å¸ˆå¯ä»¥ç»™ä»»ä½•å­¦é™¢/ä¸“ä¸šçš„å­¦ç”Ÿä¸Šè¯¾  
âœ… **çµæ´»é…ç½®**: æ”¯æŒå…¬å…±åŸºç¡€è¯¾ã€ä¸“ä¸šäº¤å‰è¯¾ç­‰å¤šç§åœºæ™¯  
âœ… **ä¾¿æ·æ“ä½œ**: ä¸€é”®åˆ‡æ¢"æ˜¾ç¤ºæ‰€æœ‰æ•™å¸ˆ"æ¨¡å¼  
âœ… **ç²¾ç¡®ç»Ÿè®¡**: æ¸…æ™°è®°å½•è·¨å­¦é™¢æˆè¯¾æƒ…å†µ  
âœ… **æƒé™æ¸…æ™°**: æ•™å¸ˆæŸ¥çœ‹è‡ªå·±çš„æ‰€æœ‰æˆè¯¾ï¼Œç®¡ç†å‘˜æŸ¥çœ‹å­¦é™¢æ‰€æœ‰è¯¾ç¨‹  

---

## ğŸ¯ å…¸å‹åº”ç”¨åœºæ™¯

### åœºæ™¯ä¸€: å…¬å…±åŸºç¡€è¯¾

#### æ•°å­¦ç±»è¯¾ç¨‹
```
æ•°å­¦å­¦é™¢ â†’ å…¨æ ¡ç†å·¥ç§‘å­¦ç”Ÿ
â”œâ”€â”€ é«˜ç­‰æ•°å­¦ (è®¡ç®—æœºã€ç”µå­ã€æœºæ¢°ç­‰ä¸“ä¸š)
â”œâ”€â”€ çº¿æ€§ä»£æ•° (å·¥ç§‘å„ä¸“ä¸š)
â””â”€â”€ æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡ (ç†å·¥ç§‘ä¸“ä¸š)
```

#### å¤–è¯­ç±»è¯¾ç¨‹
```
å¤–è¯­å­¦é™¢ â†’ å…¨æ ¡å„ä¸“ä¸šå­¦ç”Ÿ
â”œâ”€â”€ å¤§å­¦è‹±è¯­ (åˆ†çº§æ•™å­¦)
â”œâ”€â”€ è‹±è¯­å¬åŠ›
â””â”€â”€ è‹±è¯­å£è¯­
```

#### é€šè¯†ç±»è¯¾ç¨‹
```
ä½“è‚²å­¦é™¢ â†’ å…¨æ ¡å­¦ç”Ÿ
â”œâ”€â”€ ä½“è‚²è¯¾ç¨‹ (ç¯®çƒã€è¶³çƒã€æ¸¸æ³³ç­‰)

æ€æ”¿å­¦é™¢ â†’ å…¨æ ¡å­¦ç”Ÿ
â”œâ”€â”€ æ€æƒ³é“å¾·ä¿®å…»ä¸æ³•å¾‹åŸºç¡€
â”œâ”€â”€ ä¸­å›½è¿‘ç°ä»£å²çº²è¦
â””â”€â”€ é©¬å…‹æ€ä¸»ä¹‰åŸºæœ¬åŸç†
```

### åœºæ™¯äºŒ: ä¸“ä¸šäº¤å‰è¯¾ç¨‹

```
è®¡ç®—æœºå­¦é™¢ â†’ ç”µå­å·¥ç¨‹å­¦é™¢
- è®¡ç®—æœºåŸºç¡€
- ç¨‹åºè®¾è®¡åŸºç¡€

ç»æµå­¦é™¢ â†’ ç®¡ç†å­¦é™¢
- ç»æµå­¦åŸç†
- å¾®è§‚ç»æµå­¦

ç‰©ç†å­¦é™¢ â†’ ææ–™å­¦é™¢
- å¤§å­¦ç‰©ç†
- ç‰©ç†å®éªŒ
```

### åœºæ™¯ä¸‰: ç‰¹è‰²é€‰ä¿®è¯¾

```
è‰ºæœ¯å­¦é™¢ â†’ å…¨æ ¡å­¦ç”Ÿ
- ç¾æœ¯é‰´èµ
- éŸ³ä¹æ¬£èµ

åˆ›ä¸šå­¦é™¢ â†’ å…¨æ ¡å­¦ç”Ÿ
- åˆ›æ–°åˆ›ä¸šåŸºç¡€
- å•†ä¸šè®¡åˆ’ä¹¦å†™ä½œ
```

---

## ğŸ› ï¸ ä½¿ç”¨æŒ‡å—

### æ–¹æ³•ä¸€: ä½¿ç”¨"æ˜¾ç¤ºæ‰€æœ‰æ•™å¸ˆ"åŠŸèƒ½

#### æ­¥éª¤1: æ‰“å¼€è¯¾ç¨‹ç®¡ç†é¡µé¢
è®¿é—®: `/courses`

#### æ­¥éª¤2: å‹¾é€‰"æ˜¾ç¤ºæ‰€æœ‰æ•™å¸ˆ"
```html
æ–°å¢/ç¼–è¾‘è¯¾ç¨‹åŒºåŸŸ
â”œâ”€â”€ è¯¾ç¨‹åç§°: [è¾“å…¥æ¡†]
â”œâ”€â”€ è¯¾ç¨‹ç±»å‹: [å¿…ä¿®â–¼]
â”œâ”€â”€ å­¦é™¢é€‰æ‹©: [ç¦ç”¨çŠ¶æ€]
â”œâ”€â”€ ä¸“ä¸šé€‰æ‹©: [ç¦ç”¨çŠ¶æ€]
â”œâ”€â”€ æ•™å¸ˆé€‰æ‹©: [æ˜¾ç¤ºå…¨æ ¡æ‰€æœ‰æ•™å¸ˆ]
â””â”€â”€ â˜‘ï¸ æ˜¾ç¤ºæ‰€æœ‰æ•™å¸ˆï¼ˆè·¨å­¦é™¢/ä¸“ä¸šï¼‰â† å‹¾é€‰è¿™é‡Œ
```

#### æ­¥éª¤3: é€‰æ‹©æ•™å¸ˆå¹¶åˆ›å»ºè¯¾ç¨‹
```javascript
// å‰ç«¯è‡ªåŠ¨è°ƒç”¨
document.getElementById('showAllTeachers').checked = true;
toggleTeacherFilter();  // æ˜¾ç¤ºå…¨æ ¡æ‰€æœ‰æ•™å¸ˆ

// é€‰æ‹©æ•™å¸ˆï¼ˆä¾‹å¦‚ï¼šæ•°å­¦å­¦é™¢çš„å¼ ä¸‰è€å¸ˆï¼‰
document.getElementById('courseTeacher').value = 5;

// åˆ›å»ºè¯¾ç¨‹
await api('/api/courses/courses/', 'POST', {
    name: 'é«˜ç­‰æ•°å­¦',
    course_type: 'required',
    teacher: 5,              // æ•°å­¦å­¦é™¢å¼ ä¸‰è€å¸ˆ
    department: 10,          // è¯¾ç¨‹å½’å±ï¼šè®¡ç®—æœºä¸“ä¸š
    edu_level: 'undergraduate'
});
```

#### æ­¥éª¤4: æ­£å¸¸æ’è¯¾
æ’è¯¾æ—¶ä¸å—ä»»ä½•é™åˆ¶ï¼Œå¯ä»¥ä¸ºä»»ä½•ç­çº§å®‰æ’æ­¤è¯¾ç¨‹ã€‚

### æ–¹æ³•äºŒ: ä½¿ç”¨å­¦é™¢/ä¸“ä¸šç­›é€‰

å¦‚æœæ‚¨çŸ¥é“æ•™å¸ˆæ‰€å±çš„å­¦é™¢/ä¸“ä¸šï¼š

#### æ­¥éª¤1: é€‰æ‹©æ•™å¸ˆæ‰€å±å­¦é™¢
```
å­¦é™¢é€‰æ‹©: [æ•°å­¦å­¦é™¢â–¼]
ä¸“ä¸šé€‰æ‹©: [åº”ç”¨æ•°å­¦â–¼]
æ•™å¸ˆé€‰æ‹©: [å¼ ä¸‰â–¼]  â† ä»…æ˜¾ç¤ºæ•°å­¦å­¦é™¢åº”ç”¨æ•°å­¦ä¸“ä¸šçš„æ•™å¸ˆ
```

#### æ­¥éª¤2: åˆ›å»ºè¯¾ç¨‹
```javascript
// è¯¾ç¨‹å½’å±å¯ä»¥æ˜¯å…¶ä»–å­¦é™¢/ä¸“ä¸š
{
    name: 'é«˜ç­‰æ•°å­¦',
    teacher: 5,              // æ•°å­¦å­¦é™¢æ•™å¸ˆ
    department: 10,          // å½’å±è®¡ç®—æœºä¸“ä¸š
    ...
}
```

---

## ğŸ’» ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹1: ä¸ºè®¡ç®—æœºä¸“ä¸šåˆ›å»ºç”±æ•°å­¦å­¦é™¢æ•™å¸ˆæˆè¯¾çš„è¯¾ç¨‹

```javascript
// 1. æ˜¾ç¤ºæ‰€æœ‰æ•™å¸ˆï¼ˆæ¨èï¼‰
document.getElementById('showAllTeachers').checked = true;
toggleTeacherFilter();

// 2. åˆ›å»ºè¯¾ç¨‹
const course = await api('/api/courses/courses/', 'POST', {
    name: 'é«˜ç­‰æ•°å­¦',
    course_type: 'required',
    teacher: 5,              // æ•™å¸ˆID: å¼ ä¸‰ï¼ˆæ•°å­¦å­¦é™¢ï¼‰
    department: 10,          // ä¸“ä¸šID: è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯
    edu_level: 'undergraduate'
});

// 3. ä¸ºè®¡ç®—æœº1ç­æ’è¯¾
await api('/api/courses/schedules/', 'POST', {
    school_class: 1,         // è®¡ç®—æœº2024çº§1ç­
    course: course.id,
    teacher: 5,              // å¼ ä¸‰è€å¸ˆ
    classroom: 15,           // A101æ•™å®¤
    timeslot: 2,             // å‘¨ä¸€ç¬¬2èŠ‚
    week_number: 1
});
```

### ç¤ºä¾‹2: æ‰¹é‡ä¸ºå¤šä¸ªå­¦é™¢çš„å­¦ç”Ÿæ’åŒä¸€é—¨å…¬å…±è¯¾

```javascript
// åˆ›å»º"å¤§å­¦è‹±è¯­"è¯¾ç¨‹ï¼ˆå¤–è¯­å­¦é™¢æè€å¸ˆæˆè¯¾ï¼‰
const englishCourse = await api('/api/courses/courses/', 'POST', {
    name: 'å¤§å­¦è‹±è¯­',
    course_type: 'required',
    teacher: 20,             // æå››ï¼ˆå¤–è¯­å­¦é™¢ï¼‰
    department: 100,         // å½’å±ï¼šå…¬å…±è¯¾ç¨‹
    edu_level: 'undergraduate'
});

// ä¸ºå¤šä¸ªå­¦é™¢çš„ç­çº§æ’è¯¾
const classes = [
    { id: 1, name: 'è®¡ç®—æœº1ç­', dept: 'è®¡ç®—æœºå­¦é™¢' },
    { id: 5, name: 'ç”µå­å·¥ç¨‹1ç­', dept: 'ç”µå­å·¥ç¨‹å­¦é™¢' },
    { id: 10, name: 'æœºæ¢°1ç­', dept: 'æœºæ¢°å­¦é™¢' },
];

for (const cls of classes) {
    await api('/api/courses/auto-schedule/', 'POST', {
        school_class: cls.id,
        courses: [englishCourse.id],
        start_week: 1,
        end_week: 18,
        week_mode: 'all'
    });
    
    console.log(`å·²ä¸º${cls.name}(${cls.dept})æ’è¯¾`);
}
```

### ç¤ºä¾‹3: æŸ¥è¯¢æ•™å¸ˆçš„è·¨å­¦é™¢æˆè¯¾æƒ…å†µ

```javascript
// æŸ¥çœ‹å¼ ä¸‰è€å¸ˆç»™å“ªäº›å­¦é™¢çš„å­¦ç”Ÿä¸Šè¯¾
const schedules = await api('/api/courses/schedules?teacher=5&week_number=1');

// æŒ‰å­¦é™¢åˆ†ç»„ç»Ÿè®¡
const byCollege = {};
schedules.forEach(sch => {
    const collegeName = getCollegeName(sch.school_class);
    byCollege[collegeName] = (byCollege[collegeName] || 0) + 1;
});

console.log('å¼ ä¸‰è€å¸ˆè·¨å­¦é™¢æˆè¯¾ç»Ÿè®¡:', byCollege);
// è¾“å‡º:
// {
//   "è®¡ç®—æœºå­¦é™¢": 4èŠ‚,
//   "ç”µå­å·¥ç¨‹å­¦é™¢": 3èŠ‚,
//   "æœºæ¢°å­¦é™¢": 2èŠ‚
// }
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### å…³é”®å­—æ®µè¯´æ˜

#### 1. TeacherProfile (æ•™å¸ˆè¡¨)
```python
class TeacherProfile(models.Model):
    teacher_id = models.CharField()      # æ•™å¸ˆå·¥å·
    department = models.ForeignKey()     # æ•™å¸ˆæ‰€å±ä¸“ä¸šï¼ˆç®¡ç†ç»´åº¦ï¼‰
    # æ³¨æ„: æ•™å¸ˆæˆè¯¾ä¸å—æ­¤å­—æ®µé™åˆ¶
```

**è¯´æ˜**: `department` å­—æ®µç”¨äºç®¡ç†å’Œç»Ÿè®¡ï¼Œä½†ä¸é™åˆ¶æ•™å¸ˆçš„æˆè¯¾èŒƒå›´ã€‚

#### 2. Course (è¯¾ç¨‹è¡¨)
```python
class Course(models.Model):
    name = models.CharField()            # è¯¾ç¨‹åç§°
    teacher = models.ForeignKey()        # æˆè¯¾æ•™å¸ˆï¼ˆå¯è·¨å­¦é™¢ï¼‰
    department = models.ForeignKey()     # è¯¾ç¨‹å½’å±ä¸“ä¸šï¼ˆç»Ÿè®¡ç»´åº¦ï¼‰
    # teacher å’Œ department å¯ä»¥å±äºä¸åŒå­¦é™¢
```

**è¯´æ˜**: 
- `teacher`: å®é™…æˆè¯¾çš„æ•™å¸ˆï¼Œå¯ä»¥æ˜¯ä»»ä½•å­¦é™¢çš„æ•™å¸ˆ
- `department`: è¯¾ç¨‹å½’å±çš„ä¸“ä¸šï¼Œç”¨äºè¯¾ç¨‹åˆ†ç±»å’Œç»Ÿè®¡

**ç¤ºä¾‹æ•°æ®**:
```json
{
    "id": 1,
    "name": "é«˜ç­‰æ•°å­¦",
    "teacher": 5,          // å¼ ä¸‰ï¼ˆæ•°å­¦å­¦é™¢ï¼‰
    "department": 10       // è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ï¼ˆè®¡ç®—æœºå­¦é™¢ï¼‰
}
```

#### 3. CourseSchedule (æ’è¯¾è¡¨)
```python
class CourseSchedule(models.Model):
    school_class = models.ForeignKey()   # ä¸Šè¯¾ç­çº§ï¼ˆä»»ä½•å­¦é™¢ï¼‰
    course = models.ForeignKey()         # è¯¾ç¨‹
    teacher = models.ForeignKey()        # æ•™å¸ˆï¼ˆä»»ä½•å­¦é™¢ï¼‰
    # ä¸‰è€…ä¹‹é—´æ— å­¦é™¢é™åˆ¶
```

**ç¤ºä¾‹æ•°æ®**:
```json
{
    "id": 100,
    "school_class": 1,     // è®¡ç®—æœº2024çº§1ç­ï¼ˆè®¡ç®—æœºå­¦é™¢ï¼‰
    "course": 1,           // é«˜ç­‰æ•°å­¦
    "teacher": 5,          // å¼ ä¸‰ï¼ˆæ•°å­¦å­¦é™¢ï¼‰
    "timeslot": 2,
    "week_number": 1
}
```

### æ•°æ®å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°å­¦å­¦é™¢       â”‚
â”‚  â”œâ”€ åº”ç”¨æ•°å­¦ç³»  â”‚
â”‚  â””â”€ æ•™å¸ˆ: å¼ ä¸‰  â”‚â—„â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                        â”‚ teacher_id (è·¨å­¦é™¢å¼•ç”¨)
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  è¯¾ç¨‹: é«˜ç­‰æ•°å­¦ â”‚â”€â”€â”€â”€â”€â”˜
â”‚  â”œâ”€ æ•™å¸ˆ: å¼ ä¸‰  â”‚
â”‚  â””â”€ å½’å±: è®¡ç®—æœºâ”‚â—„â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                        â”‚ course_id
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  æ’è¯¾è®°å½•       â”‚â”€â”€â”€â”€â”€â”˜
â”‚  â”œâ”€ ç­çº§: è®¡ç®—æœº1ç­
â”‚  â”œâ”€ æ•™å¸ˆ: å¼ ä¸‰  â”‚
â”‚  â””â”€ æ—¶é—´: å‘¨ä¸€2èŠ‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¯´æ˜: æ•™å¸ˆ(æ•°å­¦å­¦é™¢) â†’ è¯¾ç¨‹(å½’å±è®¡ç®—æœº) â†’ ç­çº§(è®¡ç®—æœºå­¦é™¢)
```

---

## ğŸ“Š ç»Ÿè®¡ä¸æŠ¥è¡¨

### 1. æ•™å¸ˆå·¥ä½œé‡ç»Ÿè®¡ï¼ˆå«è·¨å­¦é™¢æˆè¯¾ï¼‰

#### SQLæŸ¥è¯¢
```sql
SELECT 
    t.teacher_id AS æ•™å¸ˆå·¥å·,
    u.first_name AS æ•™å¸ˆå§“å,
    td.name AS æ•™å¸ˆæ‰€å±ä¸“ä¸š,
    tc.name AS æ•™å¸ˆæ‰€å±å­¦é™¢,
    
    -- æˆè¯¾å­¦é™¢åˆ†å¸ƒ
    sc_col.name AS æˆè¯¾å­¦é™¢,
    COUNT(DISTINCT cs.school_class_id) AS æˆè¯¾ç­çº§æ•°,
    COUNT(*) AS æ€»è¯¾æ—¶æ•°,
    
    -- è¯¾ç¨‹ä¿¡æ¯
    c.name AS è¯¾ç¨‹åç§°
FROM courses_courseschedule cs
JOIN courses_course c ON cs.course_id = c.id
JOIN accounts_teacherprofile t ON cs.teacher_id = t.id
JOIN accounts_userprofile up ON t.user_profile_id = up.id
JOIN auth_user u ON up.user_id = u.id
JOIN organization_major td ON t.department_id = td.id
JOIN organization_college tc ON td.college_id = tc.id

-- æˆè¯¾ç­çº§ä¿¡æ¯
JOIN organization_class sc ON cs.school_class_id = sc.id
JOIN organization_major sd ON sc.department_id = sd.id
JOIN organization_college sc_col ON sd.college_id = sc_col.id

WHERE cs.week_number = 1
GROUP BY t.id, sc_col.id, c.id
ORDER BY t.teacher_id, sc_col.name
```

#### ç¤ºä¾‹è¾“å‡º
| æ•™å¸ˆå§“å | æ‰€å±å­¦é™¢ | æˆè¯¾å­¦é™¢ | è¯¾ç¨‹åç§° | ç­çº§æ•° | è¯¾æ—¶æ•° |
|---------|---------|---------|---------|--------|--------|
| å¼ ä¸‰ | æ•°å­¦å­¦é™¢ | è®¡ç®—æœºå­¦é™¢ | é«˜ç­‰æ•°å­¦ | 3 | 12 |
| å¼ ä¸‰ | æ•°å­¦å­¦é™¢ | ç”µå­å·¥ç¨‹å­¦é™¢ | é«˜ç­‰æ•°å­¦ | 2 | 8 |
| å¼ ä¸‰ | æ•°å­¦å­¦é™¢ | æœºæ¢°å­¦é™¢ | çº¿æ€§ä»£æ•° | 2 | 8 |
| **åˆè®¡** | | | | **7** | **28** |

### 2. å­¦é™¢æ¥å—æœåŠ¡ç»Ÿè®¡ï¼ˆæ¥å—å¤–é™¢æ•™å¸ˆæˆè¯¾æƒ…å†µï¼‰

#### SQLæŸ¥è¯¢
```sql
SELECT 
    sc_col.name AS æ¥å—æœåŠ¡å­¦é™¢,
    tc.name AS æä¾›æœåŠ¡å­¦é™¢,
    c.name AS è¯¾ç¨‹åç§°,
    u.first_name AS æ•™å¸ˆå§“å,
    COUNT(*) AS è¯¾æ—¶æ•°
FROM courses_courseschedule cs
JOIN courses_course c ON cs.course_id = c.id
JOIN accounts_teacherprofile t ON cs.teacher_id = t.id
JOIN accounts_userprofile up ON t.user_profile_id = up.id
JOIN auth_user u ON up.user_id = u.id
JOIN organization_major td ON t.department_id = td.id
JOIN organization_college tc ON td.college_id = tc.id

JOIN organization_class sc ON cs.school_class_id = sc.id
JOIN organization_major sd ON sc.department_id = sd.id
JOIN organization_college sc_col ON sd.college_id = sc_col.id

WHERE tc.id != sc_col.id  -- è·¨å­¦é™¢æˆè¯¾
GROUP BY sc_col.id, tc.id, c.id
ORDER BY sc_col.name, è¯¾æ—¶æ•° DESC
```

#### ç¤ºä¾‹è¾“å‡º
| æ¥å—æœåŠ¡å­¦é™¢ | æä¾›æœåŠ¡å­¦é™¢ | è¯¾ç¨‹åç§° | æ•™å¸ˆ | è¯¾æ—¶æ•° |
|------------|------------|---------|------|--------|
| è®¡ç®—æœºå­¦é™¢ | æ•°å­¦å­¦é™¢ | é«˜ç­‰æ•°å­¦ | å¼ ä¸‰ | 12 |
| è®¡ç®—æœºå­¦é™¢ | å¤–è¯­å­¦é™¢ | å¤§å­¦è‹±è¯­ | æå›› | 8 |
| è®¡ç®—æœºå­¦é™¢ | ä½“è‚²å­¦é™¢ | ä½“è‚² | ç‹äº” | 4 |

### 3. å‰ç«¯ç»Ÿè®¡ç¤ºä¾‹

```javascript
// ç»Ÿè®¡è·¨å­¦é™¢æˆè¯¾æƒ…å†µ
async function getCrossCollegeStats() {
    const schedules = await api('/api/courses/schedules?week_number=1');
    
    const stats = {
        totalCross: 0,
        totalSame: 0,
        byTeacher: {},
        byCollege: {}
    };
    
    for (const sch of schedules) {
        const teacher = await api(`/api/accounts/teachers/${sch.teacher}`);
        const classInfo = await api(`/api/org/classes/${sch.school_class}`);
        
        const teacherCollege = teacher.department.college;
        const classCollege = classInfo.department.college;
        
        if (teacherCollege !== classCollege) {
            stats.totalCross++;
            
            // æŒ‰æ•™å¸ˆç»Ÿè®¡
            stats.byTeacher[teacher.id] = (stats.byTeacher[teacher.id] || 0) + 1;
            
            // æŒ‰å­¦é™¢ç»Ÿè®¡
            const key = `${teacherCollege} â†’ ${classCollege}`;
            stats.byCollege[key] = (stats.byCollege[key] || 0) + 1;
        } else {
            stats.totalSame++;
        }
    }
    
    return stats;
}

// ä½¿ç”¨
const stats = await getCrossCollegeStats();
console.log('è·¨å­¦é™¢æˆè¯¾ç»Ÿè®¡:', stats);
// è¾“å‡º:
// {
//   totalCross: 25,        // 25èŠ‚è¯¾ä¸ºè·¨å­¦é™¢æˆè¯¾
//   totalSame: 75,         // 75èŠ‚è¯¾ä¸ºæœ¬å­¦é™¢æˆè¯¾
//   byTeacher: {
//     5: 12,               // æ•™å¸ˆ5è·¨å­¦é™¢æˆè¯¾12èŠ‚
//     20: 8                // æ•™å¸ˆ20è·¨å­¦é™¢æˆè¯¾8èŠ‚
//   },
//   byCollege: {
//     "æ•°å­¦å­¦é™¢ â†’ è®¡ç®—æœºå­¦é™¢": 12,
//     "å¤–è¯­å­¦é™¢ â†’ è®¡ç®—æœºå­¦é™¢": 8
//   }
// }
```

---

## ğŸ” æƒé™æ§åˆ¶

### æ•™å¸ˆæƒé™

#### æŸ¥çœ‹æƒé™
```python
# æ•™å¸ˆå¯ä»¥æŸ¥çœ‹è‡ªå·±çš„æ‰€æœ‰æˆè¯¾ï¼ˆåŒ…æ‹¬è·¨å­¦é™¢çš„ï¼‰
if user.profile.role == 'teacher':
    schedules = CourseSchedule.objects.filter(
        teacher=user.profile.teacher_profile
    )
```

**è¯´æ˜**: æ•™å¸ˆèƒ½çœ‹åˆ°è‡ªå·±ç»™æ‰€æœ‰å­¦é™¢/ä¸“ä¸šå­¦ç”Ÿä¸Šçš„è¯¾ã€‚

#### ä¿®æ”¹æƒé™
```python
# æ•™å¸ˆå¯ä»¥ä¿®æ”¹è‡ªå·±çš„æ’è¯¾ï¼ˆåŒ…æ‹¬è·¨å­¦é™¢çš„ï¼‰
if user.profile.role == 'teacher':
    schedule = CourseSchedule.objects.get(id=schedule_id)
    if schedule.teacher == user.profile.teacher_profile:
        # å…è®¸ä¿®æ”¹
        schedule.classroom = new_classroom
        schedule.save()
```

### å­¦é™¢ç®¡ç†å‘˜æƒé™

#### æŸ¥çœ‹æƒé™
```python
# æ•™åŠ¡é•¿å¯ä»¥æŸ¥çœ‹æœ¬å­¦é™¢å­¦ç”Ÿçš„æ‰€æœ‰è¯¾ç¨‹ï¼ˆåŒ…æ‹¬å¤–é™¢æ•™å¸ˆæˆè¯¾çš„ï¼‰
if user.profile.role == 'dean':
    schedules = CourseSchedule.objects.filter(
        school_class__department__college=user.profile.college
    )
```

**è¯´æ˜**: å­¦é™¢ç®¡ç†å‘˜èƒ½çœ‹åˆ°æœ¬å­¦é™¢å­¦ç”Ÿçš„æ‰€æœ‰è¯¾ç¨‹ï¼ŒåŒ…æ‹¬å¤–é™¢æ•™å¸ˆæˆè¯¾çš„è¯¾ç¨‹ã€‚

#### ç»Ÿè®¡æƒé™
```python
# å­¦é™¢ç®¡ç†å‘˜å¯ä»¥ç»Ÿè®¡æœ¬å­¦é™¢æ¥å—çš„å¤–é™¢æ•™å­¦æœåŠ¡
cross_college_courses = CourseSchedule.objects.filter(
    school_class__department__college=dean_college
).exclude(
    teacher__department__college=dean_college
)
```

### è¶…çº§ç®¡ç†å‘˜æƒé™

```python
# è¶…çº§ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰è¯¾ç¨‹
if user.is_superuser or user.profile.role in ['super_admin', 'principal']:
    schedules = CourseSchedule.objects.all()
```

---

## ğŸ¨ å‰ç«¯ç•Œé¢

### UIå˜åŒ–è¯´æ˜

#### åŸç•Œé¢ï¼ˆä»…æ˜¾ç¤ºæœ¬ä¸“ä¸šæ•™å¸ˆï¼‰
```
æ–°å¢è¯¾ç¨‹
â”œâ”€â”€ è¯¾ç¨‹åç§°: [_____________]
â”œâ”€â”€ å­¦é™¢é€‰æ‹©: [è®¡ç®—æœºå­¦é™¢â–¼]
â”œâ”€â”€ ä¸“ä¸šé€‰æ‹©: [è®¡ç®—æœºç§‘å­¦â–¼]
â””â”€â”€ æ•™å¸ˆé€‰æ‹©: [ä»…æ˜¾ç¤ºè®¡ç®—æœºç§‘å­¦ä¸“ä¸šæ•™å¸ˆ]
```

#### æ–°ç•Œé¢ï¼ˆæ”¯æŒè·¨å­¦é™¢é€‰æ‹©ï¼‰
```
æ–°å¢è¯¾ç¨‹
â”œâ”€â”€ è¯¾ç¨‹åç§°: [_____________]
â”œâ”€â”€ å­¦é™¢é€‰æ‹©: [è®¡ç®—æœºå­¦é™¢â–¼] (å¯ç¦ç”¨)
â”œâ”€â”€ ä¸“ä¸šé€‰æ‹©: [è®¡ç®—æœºç§‘å­¦â–¼] (å¯ç¦ç”¨)
â”œâ”€â”€ æ•™å¸ˆé€‰æ‹©: [æ˜¾ç¤ºæ‰€æœ‰æˆ–ç­›é€‰åçš„æ•™å¸ˆ]
â””â”€â”€ â˜‘ï¸ æ˜¾ç¤ºæ‰€æœ‰æ•™å¸ˆï¼ˆè·¨å­¦é™¢/ä¸“ä¸šï¼‰
          â†‘
       å‹¾é€‰åæ˜¾ç¤ºå…¨æ ¡æ‰€æœ‰æ•™å¸ˆ
```

### JavaScriptå®ç°

```javascript
// åˆ‡æ¢æ•™å¸ˆæ˜¾ç¤ºæ¨¡å¼
function toggleTeacherFilter() {
    const showAll = document.getElementById('showAllTeachers')?.checked;
    const collegeSelect = document.getElementById('courseTeacherCollege');
    const deptSelect = document.getElementById('courseTeacherDept');
    
    if (showAll) {
        // æ˜¾ç¤ºæ‰€æœ‰æ•™å¸ˆæ¨¡å¼
        collegeSelect.disabled = true;
        deptSelect.disabled = true;
        updateTeacherSelect('courseTeacher', tt.teachers);  // æ˜¾ç¤ºå…¨éƒ¨
    } else {
        // ç­›é€‰æ¨¡å¼
        collegeSelect.disabled = false;
        deptSelect.disabled = false;
        filterTeachersByDept();  // æ ¹æ®å­¦é™¢/ä¸“ä¸šç­›é€‰
    }
}
```

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. å…¬å…±è¯¾ç¨‹ç®¡ç†

#### å»ºè®®åšæ³•
ä¸ºå…¬å…±è¯¾åˆ›å»ºç»Ÿä¸€çš„"å…¬å…±è¯¾ç¨‹"åˆ†ç±»ï¼š

```python
# åˆ›å»º"å…¬å…±è¯¾ç¨‹"ä¸“ä¸š
public_dept = Department.objects.create(
    name='å…¬å…±è¯¾ç¨‹',
    code='PUBLIC',
    college=é€šè¯†æ•™è‚²å­¦é™¢
)

# æ‰€æœ‰å…¬å…±è¯¾å½’å±æ­¤ä¸“ä¸š
Course.objects.create(
    name='å¤§å­¦è‹±è¯­',
    department=public_dept,
    teacher=å¤–è¯­å­¦é™¢æ•™å¸ˆ,
    course_type='required'
)

Course.objects.create(
    name='é«˜ç­‰æ•°å­¦',
    department=public_dept,
    teacher=æ•°å­¦å­¦é™¢æ•™å¸ˆ,
    course_type='required'
)
```

#### ä¼˜ç‚¹
- âœ… ç»Ÿä¸€ç®¡ç†å…¬å…±è¯¾
- âœ… ä¾¿äºç»Ÿè®¡å…¬å…±è¯¾å¼€è®¾æƒ…å†µ
- âœ… æ–¹ä¾¿å­¦ç”Ÿé€‰è¯¾æŸ¥è¯¢

### 2. è¯¾ç¨‹å‘½åè§„èŒƒ

#### æ¨èå‘½å
```
é«˜ç­‰æ•°å­¦(ç†å·¥ç±»)
é«˜ç­‰æ•°å­¦(ç»ç®¡ç±»)
å¤§å­¦è‹±è¯­I
å¤§å­¦è‹±è¯­II
ä½“è‚²(ç¯®çƒ)
ä½“è‚²(è¶³çƒ)
```

#### ä¸æ¨èå‘½å
```
é«˜ç­‰æ•°å­¦        â† å¤ªç¬¼ç»Ÿï¼Œæ— æ³•åŒºåˆ†æˆè¯¾å¯¹è±¡
è‹±è¯­            â† å¤ªç®€å•ï¼Œæ— æ³•åŒºåˆ†çº§åˆ«
ä½“è‚²            â† å¤ªæ¨¡ç³Šï¼Œæ— æ³•åŒºåˆ†é¡¹ç›®
```

### 3. æ•™å­¦ç­ç®¡ç†

å¯¹äºå¤§è§„æ¨¡å…¬å…±è¯¾ï¼Œå»ºè®®ä½¿ç”¨æ•™å­¦ç­ï¼š

```python
# åˆ›å»ºæ•™å­¦ç­ï¼ˆè·¨è¡Œæ”¿ç­ï¼‰
teaching_class = Class.objects.create(
    name='2024çº§é«˜ç­‰æ•°å­¦1ç­(ç†å·¥ç±»)',
    class_type='teaching',
    department=public_dept,
    grade=2024
)

# å°†å¤šä¸ªè¡Œæ”¿ç­çš„å­¦ç”ŸåŠ å…¥æ•™å­¦ç­
# (éœ€è¦æ‰©å±•å­¦ç”Ÿè¡¨ï¼Œæ·»åŠ teaching_classå­—æ®µ)

# ä¸ºæ•™å­¦ç­æ’è¯¾
CourseSchedule.objects.create(
    school_class=teaching_class,
    course=é«˜ç­‰æ•°å­¦,
    teacher=å¼ ä¸‰,
    ...
)
```

### 4. å·¥ä½œé‡ç»Ÿè®¡

```python
# å®šæœŸç»Ÿè®¡æ•™å¸ˆå·¥ä½œé‡
from django.db.models import Count

teacher_workload = CourseSchedule.objects.filter(
    week_number=1
).values(
    'teacher__teacher_id',
    'teacher__user_profile__user__first_name'
).annotate(
    total_hours=Count('id'),
    cross_college_hours=Count('id', filter=Q(
        school_class__department__college__ne=F('teacher__department__college')
    ))
).order_by('-total_hours')

# è¾“å‡º
for item in teacher_workload:
    print(f"{item['teacher__user_profile__user__first_name']}: "
          f"æ€»è¯¾æ—¶{item['total_hours']}, "
          f"è·¨å­¦é™¢è¯¾æ—¶{item['cross_college_hours']}")
```

---

## ğŸš€ é«˜çº§åŠŸèƒ½ï¼ˆæœªæ¥æ‰©å±•ï¼‰

### 1. æ•™å­¦ç­ç®¡ç†ç³»ç»Ÿ
- æ”¯æŒåˆ›å»ºè·¨è¡Œæ”¿ç­çš„æ•™å­¦ç­
- å­¦ç”Ÿå¯åŒæ—¶å±äºè¡Œæ”¿ç­å’Œæ•™å­¦ç­
- æ”¯æŒæ•™å­¦ç­é€‰è¯¾

### 2. è·¨å­¦é™¢è¯¾ç¨‹å…±äº«
- å­¦é™¢ä¹‹é—´å¯ä»¥å…±äº«ä¼˜è´¨è¯¾ç¨‹
- æ”¯æŒè¿œç¨‹æˆè¯¾ï¼ˆç½‘ç»œç›´æ’­ï¼‰
- è¯¾ç¨‹èµ„æºå…±äº«å¹³å°

### 3. æ™ºèƒ½æ¨è
- æ ¹æ®è¯¾ç¨‹å†…å®¹æ¨èåˆé€‚çš„æ•™å¸ˆ
- æ¨èè·¨å­¦é™¢æ•™å­¦åˆä½œæœºä¼š

### 4. å·¥ä½œé‡è‡ªåŠ¨è®¡ç®—
- è‡ªåŠ¨è®¡ç®—è·¨å­¦é™¢æˆè¯¾è¡¥è´´
- ç”Ÿæˆå·¥ä½œé‡æŠ¥è¡¨
- æ”¯æŒå¤šç»´åº¦ç»Ÿè®¡åˆ†æ

---

## â“ å¸¸è§é—®é¢˜

### Q1: è·¨å­¦é™¢æˆè¯¾ä¼šå½±å“æƒé™å—ï¼Ÿ
**A**: ä¸ä¼šã€‚æ•™å¸ˆèƒ½æŸ¥çœ‹å’Œç®¡ç†è‡ªå·±çš„æ‰€æœ‰æˆè¯¾ï¼Œä¸è®ºæ˜¯å¦è·¨å­¦é™¢ã€‚å­¦é™¢ç®¡ç†å‘˜èƒ½æŸ¥çœ‹æœ¬å­¦é™¢å­¦ç”Ÿçš„æ‰€æœ‰è¯¾ç¨‹ï¼ŒåŒ…æ‹¬å¤–é™¢æ•™å¸ˆæˆè¯¾çš„è¯¾ç¨‹ã€‚

### Q2: å¦‚ä½•ç»Ÿè®¡è·¨å­¦é™¢æˆè¯¾å·¥ä½œé‡ï¼Ÿ
**A**: ä½¿ç”¨ä¸Šæ–‡æä¾›çš„SQLæŸ¥è¯¢æˆ–è°ƒç”¨APIç»Ÿè®¡æ¥å£ï¼Œå¯ä»¥ç²¾ç¡®ç»Ÿè®¡æ¯ä½æ•™å¸ˆçš„è·¨å­¦é™¢æˆè¯¾æƒ…å†µã€‚

### Q3: è¯¾ç¨‹çš„departmentå­—æ®µå¦‚ä½•å¡«å†™ï¼Ÿ
**A**: å»ºè®®ï¼š
- å…¬å…±åŸºç¡€è¯¾ï¼šå½’å±"å…¬å…±è¯¾ç¨‹"
- ä¸“ä¸šè¯¾ï¼šå½’å±ä¸»è¦æˆè¯¾å¯¹è±¡çš„ä¸“ä¸š
- äº¤å‰è¯¾ç¨‹ï¼šå½’å±æå‡ºå¼€è¯¾éœ€æ±‚çš„ä¸“ä¸š

### Q4: æ˜¯å¦éœ€è¦ä¸ºè·¨å­¦é™¢è¯¾ç¨‹è®¾ç½®ç‰¹æ®Šæ ‡è®°ï¼Ÿ
**A**: ä¸éœ€è¦ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«è·¨å­¦é™¢æˆè¯¾ï¼ˆé€šè¿‡æ¯”è¾ƒæ•™å¸ˆæ‰€å±å­¦é™¢å’Œç­çº§æ‰€å±å­¦é™¢ï¼‰ã€‚

### Q5: å¦‚ä½•é˜²æ­¢æ’è¯¾å†²çªï¼Ÿ
**A**: ç³»ç»Ÿçš„å†²çªæ£€æµ‹æœºåˆ¶å¯¹è·¨å­¦é™¢æˆè¯¾åŒæ ·æœ‰æ•ˆï¼Œä¼šè‡ªåŠ¨æ£€æµ‹æ•™å¸ˆã€ç­çº§ã€æ•™å®¤çš„æ—¶é—´å†²çªã€‚

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰ç–‘é—®æˆ–éœ€è¦å¸®åŠ©ï¼Œè¯·æŸ¥é˜…ï¼š
- [å®Œæ•´è®¾è®¡æ–‡æ¡£](./COURSE_MANAGEMENT_DESIGN.md)
- [å¿«é€Ÿå‚è€ƒæŒ‡å—](./QUICK_REFERENCE.md)
- [å·¥ä½œæµç¨‹å›¾](./COURSE_WORKFLOW_DIAGRAM.md)

---

**ç‰ˆæœ¬**: 1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-12-09  
**ç»´æŠ¤å›¢é˜Ÿ**: EduCloud Development Team

