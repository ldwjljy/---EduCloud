# EduCloud 部署检查清单

使用此清单确保项目在部署前已完全准备好。

## 📋 快速检查

运行自动检查脚本：

```bash
# Windows
python check_deployment.py

# Linux/Mac
python3 check_deployment.py
```

## ✅ 详细检查清单

### 1. 环境准备

#### 系统要求
- [ ] Python 3.8+ 已安装
  ```bash
  python --version  # 或 python3 --version
  ```
- [ ] MySQL 5.7+ 或 8.0+ 已安装并运行
  ```bash
  # Windows: 检查服务
  # Linux: systemctl status mysql
  # Mac: brew services list
  ```
- [ ] pip 已安装且为最新版本
  ```bash
  python -m pip install --upgrade pip
  ```

#### 虚拟环境（推荐）
- [ ] 已创建虚拟环境
  ```bash
  python -m venv venv
  ```
- [ ] 虚拟环境已激活
  ```bash
  # Windows
  venv\Scripts\activate
  # Linux/Mac
  source venv/bin/activate
  ```

### 2. 项目文件

#### 必需文件
- [ ] `manage.py` - Django管理脚本
- [ ] `requirements.txt` - Python依赖列表
- [ ] `.env.example` - 环境变量模板
- [ ] `.env` - 环境变量配置文件（需创建）
- [ ] `EduCloud/settings.py` - Django设置文件

#### 部署文件
- [ ] `deploy.bat` - Windows部署脚本（可选）
- [ ] `deploy.sh` - Linux/Mac部署脚本（可选）
- [ ] `DEPLOYMENT.md` - 部署文档（可选）

#### 目录结构
- [ ] `templates/` - HTML模板目录
- [ ] `static/` - 静态文件目录（CSS、JS、图片）
- [ ] `EduCloud/` - 项目配置目录

### 3. 配置文件

#### .env 文件配置

- [ ] **SECRET_KEY** 已设置且为随机值
  ```env
  SECRET_KEY=your-random-secret-key-here
  ```
  生成方式：
  ```bash
  python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
  ```

- [ ] **DEBUG** 已正确设置
  - 开发环境: `DEBUG=True`
  - 生产环境: `DEBUG=False`

- [ ] **ALLOWED_HOSTS** 已配置
  - 开发环境: `ALLOWED_HOSTS=localhost,127.0.0.1`
  - 生产环境: `ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com`

- [ ] **数据库配置** 已正确设置
  ```env
  DB_NAME=educloud
  DB_USER=your_db_user
  DB_PASSWORD=your_db_password
  DB_HOST=127.0.0.1  # 或远程数据库地址
  DB_PORT=3306
  ```

- [ ] **学期配置**（可选）
  ```env
  SEMESTER_START_DATE=2024-09-01
  SEMESTER_TOTAL_WEEKS=20
  ```

### 4. Python依赖

- [ ] 已安装所有依赖
  ```bash
  pip install -r requirements.txt
  ```

- [ ] 核心依赖包验证
  - [ ] Django
  - [ ] djangorestframework
  - [ ] PyMySQL
  - [ ] python-dotenv
  - [ ] django-filter

  验证方式：
  ```bash
  python -c "import django; print(django.get_version())"
  ```

### 5. 数据库

#### 数据库准备
- [ ] MySQL服务已启动
- [ ] 数据库已创建
  ```sql
  CREATE DATABASE educloud CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
  ```
- [ ] 数据库用户已创建并授权
  ```sql
  CREATE USER 'your_user'@'localhost' IDENTIFIED BY 'your_password';
  GRANT ALL PRIVILEGES ON educloud.* TO 'your_user'@'localhost';
  FLUSH PRIVILEGES;
  ```

#### 数据库连接测试
- [ ] 可以连接到数据库
  ```bash
  python check_deployment.py
  # 或
  python 一键检查/check_setup.py
  ```

- [ ] 数据库迁移已运行
  ```bash
  python manage.py migrate
  ```

- [ ] 无未应用的迁移
  ```bash
  python manage.py showmigrations
  ```

### 6. 静态文件

- [ ] 静态文件目录存在 (`static/`)
- [ ] 已运行静态文件收集
  ```bash
  python manage.py collectstatic --noinput
  ```
- [ ] `staticfiles/` 目录已创建并包含文件

### 7. 安全管理

#### 生产环境安全配置
- [ ] `DEBUG=False`（生产环境）
- [ ] `SECRET_KEY` 已更改为随机值
- [ ] `ALLOWED_HOSTS` 已限制为实际域名
- [ ] 数据库密码足够强
- [ ] 已考虑配置HTTPS/SSL

#### 文件权限（Linux/Mac）
- [ ] 敏感文件权限正确
  ```bash
  chmod 600 .env
  ```

### 8. 功能测试

部署前建议测试：
- [ ] 应用可以正常启动
  ```bash
  python manage.py runserver
  ```
- [ ] 可以访问首页
- [ ] 静态文件可以加载（CSS、JS）
- [ ] 用户登录功能正常
- [ ] 数据库操作正常

### 9. 生产环境额外配置（如适用）

#### 使用 Gunicorn
- [ ] Gunicorn 已安装
  ```bash
  pip install gunicorn
  ```
- [ ] Gunicorn 配置文件已创建
- [ ] Systemd/Supervisor 服务已配置

#### 使用 Nginx
- [ ] Nginx 已安装并配置
- [ ] 静态文件路径已配置
- [ ] 反向代理已配置
- [ ] SSL证书已配置（如使用HTTPS）

### 10. 备份和恢复

- [ ] 数据库备份策略已规划
- [ ] 知道如何恢复数据库
  ```bash
  mysqldump -u user -p educloud > backup.sql
  ```

## 🚀 部署步骤摘要

1. **环境准备** → 检查系统要求和虚拟环境
2. **配置文件** → 创建并配置 `.env` 文件
3. **安装依赖** → `pip install -r requirements.txt`
4. **数据库准备** → 创建数据库并运行迁移
5. **静态文件** → `python manage.py collectstatic`
6. **创建管理员** → `python manage.py createsuperuser`
7. **测试运行** → `python manage.py runserver`
8. **生产部署** → 配置 Gunicorn + Nginx（如需要）

## ❓ 遇到问题？

1. **运行自动检查**：
   ```bash
   python check_deployment.py
   ```

2. **运行项目检查**：
   ```bash
   python 一键检查/check_setup.py
   ```

3. **查看部署文档**：
   - 查看 `DEPLOYMENT.md`
   - 查看 `README.md`

4. **检查日志**：
   - Django日志
   - MySQL日志
   - 系统日志

## 📝 部署后验证

部署完成后，验证以下内容：

- [ ] 网站可以正常访问
- [ ] 所有页面加载正常
- [ ] 用户登录/注册功能正常
- [ ] 数据库读写正常
- [ ] 静态文件加载正常
- [ ] 无错误日志

---

**提示**: 使用 `check_deployment.py` 脚本可以自动完成大部分检查！
